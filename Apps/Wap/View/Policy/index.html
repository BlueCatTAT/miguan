<extend name="Base/base" />
<block name="body">
<div class="section" style="padding:10px;">
  <div class="lead">我的资产<a href="" class="pull-right btn danger btn-sm">马上充值</a></div>
  <hr/>
  <div class="row">
    <div class="cell-6" style="flex-direction:column;">
      <h3 >总资产</h3>
      <p>{$user_info['balance'] + $total_fee}</p>
    </div>
    <div class="cell-6" style="flex-direction:column;">
      <h3>昨日收益</h3>
      <p>0</p>
    </div>
  </div>
  <div class="row">
    <div class="cell-6">
      <span class='info' style='padding:0 10px;'>持仓市值</span>
      <span class='text-red' style="padding:0 10px;">{$total_price}</span>
    </div>
    <div class="cell-6">
      <span class='warning' style='padding:0 10px;'>持仓盈亏</span>
      <span class='text-red' style="padding:0 10px;">0</span>
    </div>
    <div class="cell-6">
      <span class='primary' style='padding:0 10px;'>可用资金</span>
      <span class='text-red' style="padding:0 10px;">{$user_info['balance']}</span>
    </div>
    <div class="cell-6">
      <span class='success' style='padding:0 10px;'>冻结资产</span>
      <span class='text-red' style="padding:0 10px;">{$total_fee}</span>
    </div>
  </div>
</div>
<div class="section" style="padding:10px;">
  <div class="lead">策略持仓</div>
  <hr/>
  <a href="/wap/stock/his" class="btn danger outline block">创建策略</a>
  <hr/>
  <foreach name="order_list" item="order">
  <div class="row">
    <div class="cell-6">{$order['name']} <span class="text-gray">{$order['code']}</span></div>
    <div class="cell-6">5.41 -32% <a style="position: absolute; right:10px;" data-display data-target="#box-{$order['id']}" data-trigger-method="toggle"><i class="icon icon-plus-sign text-red icon-2x"></i></a></div>
    <div class="cell-6">买入价 : {$order['buy_price']}</div>
    <div class="cell-6">成本价 : {$order['buy_price']}</div>
    <div class="cell-6">浮盈 : 5.3</div>
    <div class="cell-6">盈亏 : 5.3</div>
    <div class="cell-6">已持仓3天</div>
    <div class="cell-6">买入时间 : {$order['created_time']|date="m-d H:i", ###}</div>
  </div>
  <div class="row container inverse has-padding small hidden" id="box-{$order['id']}">
    <div class="cell-4">信用金 <span class="has-padding-h text-warning">{$order['fee']}</span></div>
    <div class="cell-4">止盈价 <span class="has-padding-h text-red">{$order['endprofit']}</span></div>
    <div class="cell-4">上涨 <span class="has-padding-h text-red">{$order['endprofit_ratio'] * 100}%</span> 止盈</div>
    <div class="cell-4">股票数 <span class="has-padding-h text-warning">{$order['volume']}<span></div>
    <div class="cell-4">止损价 <span class="has-padding-h text-green">{$order['endloss']}<span></div>
    <div class="cell-4">下跌 <span class="has-padding-h text-green">{$order['endloss_ratio'] * 100}%</span> 止损</div>
    <div class="cell-4">手续费 <span class="has-padding-h text-warning">{$order['servicecharge']}</span></div>
    <div class="cell-4">管理费 <span class="has-padding-h text-warning">{$order['managecharge']}</span></div>
    <div class="cell-4">强平价 <span class="has-padding-h text-warning">{$order['f_price']}</span></div>
    <div class="cell-12" style="justify-content:flex-end;">
      <button class="btn danger">卖出</button>
      <button class="btn warning" data-display data-backdrop="true" data-target="#endloss_{$order['id']}" data-placement="bottom">修改止损</button>
      <button class="btn warning" data-display data-backdrop="true" data-target="#endprofit_{$order['id']}" data-placement="bottom">修改止盈</button>
    </div>
  </div>
  <div id="endloss_{$order['id']}" class="affix dock-bottom modal hidden">
    <div class="heading">
      <div class="title"><strong>修改止损</strong></div>
      <nav class="nav"><a data-dismiss="display"><i class="icon-remove muted"></i></a></nav>
    </div>
    <div class="content article box">
      <div class="control">
        <label>当前止损价</label>
        <input type="text" value="{$order['endloss']}" class="input disabled"/>
      </div>
      <div class="control">
        <label>修改止损价</label>
        <input type="text" value="{$order['endloss']}" class="input endloss"/>
      </div>
      <div class="control">
        <button type="button" class="btn block warning endloss_btn" onclick="setEndloss({$order['id']})">提交</button>
      </div>
    </div>
  </div>
  <div id="endprofit_{$order['id']}" class="affix dock-bottom modal hidden">
    <div class="heading">
      <div class="title"><strong>修改止盈</strong></div>
      <nav class="nav"><a data-dismiss="display"><i class="icon-remove muted"></i></a></nav>
    </div>
    <div class="content article box">
      <div class="control">
        <label>当前止盈价</label>
        <input type="text" value="{$order['endloss']}" class="input disabled"/>
      </div>
      <div class="control">
        <label>修改止盈价</label>
        <input type="number" value="{$order['endloss']}" class="input endprofit"/>
      </div>
      <div class="control">
        <button type="button" class="btn block warning" onclick="setEndprofit({$order['id']})">提交</button>
      </div>
    </div>
  </div>
  </foreach>
</div>
<script>
function setEndloss(order_id) {
  var p = $('#endloss_'+order_id).find('.endloss').val();
  $.ajax({
    url: '/wap/policy/set_endloss',
    type: 'post',
    dataType: 'json',
    data:{'price': p, 'order_id': order_id},
    success: function(res) {
      location.reload();
    } 
  });
} 
function setEndprofit(order_id) {
  var p = $('#endprofit_'+order_id).find('.endprofit').val();
  $.ajax({
    url: '/wap/policy/set_endprofit',
    type: 'post',
    dataType: 'json',
    data:{'price': p, 'order_id': order_id},
    success: function(res) {
      location.reload();
    } 
  });
} 
</script>
</block>
